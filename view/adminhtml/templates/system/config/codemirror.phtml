<?php
/**
 * Copyright (c) 2026. Volodymyr Hryvinskyi. All rights reserved.
 * Author: Volodymyr Hryvinskyi <volodymyr@hryvinskyi.com>
 * GitHub: https://github.com/hryvinskyi
 */

/**
 * @var $block \Magento\Framework\View\Element\Template
 * @var $element \Magento\Framework\Data\Form\Element\AbstractElement
 * @var $escaper \Magento\Framework\Escaper
 */

$element = $block->getData('element');
$editorConfig = $block->getData('editor_config');
$inputId = $element->getHtmlId();
$inputName = $element->getName();
$inputValue = $element->getEscapedValue();
$disabled = $element->getCanUseWebsiteValue()
    || $element->getCanUseDefaultValue()
    || $element->getCanRestoreToDefault();

$configJson = json_encode([
    'inputId' => $inputId,
    'mode' => $editorConfig['mode'] ?? 'htmlmixed',
    'theme' => $editorConfig['theme'] ?? 'default',
    'lineNumbers' => $editorConfig['lineNumbers'] ?? true,
    'lineWrapping' => $editorConfig['lineWrapping'] ?? true,
    'readOnly' => $disabled,
], JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP);
?>
<div class="codemirror-editor-root" id="codemirror-editor-<?= $escaper->escapeHtmlAttr($inputId) ?>">
    <textarea
        id="<?= $escaper->escapeHtmlAttr($inputId) ?>"
        name="<?= $escaper->escapeHtmlAttr($inputName) ?>"
        class="admin__control-textarea codemirror-textarea"
        <?= $disabled ? 'disabled="disabled"' : '' ?>
    ><?= $escaper->escapeHtml($inputValue) ?></textarea>
</div>
<script type="text/x-magento-init">
    {
        "#codemirror-editor-<?= $escaper->escapeJs($inputId) ?>": {
            "Hryvinskyi_ConfigurationFields/js/codemirror-editor": <?= /* @noEscape */ $configJson ?>
        }
    }
</script>
